# システム構成図の要素一覧（移行後）

この資料は、**移行後（最終構成：AWS上のDatabricks）** のシステム構成図に含めるべき要素を網羅的にリストアップしたものです。

## ステータス凡例

| ステータス | 意味 |
|------------|------|
| ✅ 記載済み | 図に明示的に記載 |
| 📝 暗黙 | 図には未記載だが、存在が前提となっている |
| 🔧 詳細設計で追加 | 本番環境向けに詳細設計フェーズで追加すべき |
| ⛔ 今回不要 | 今回のプロジェクトでは使用しない |
| ⛔ 移行後不要 | 移行後の最終構成では不要（移行前で使用していた） |

---

## 1. ネットワーク層

| 要素 | 説明 | ステータス | 備考 |
|------|------|------------|------|
| **VPC** | Databricks ComputeとRDSを同一VPCに配置 | ✅ | |
| **Private Subnet** | RDSとComputeを配置（インターネット非公開） | ✅ | |
| **Public Subnet** | NAT Gateway経由で外部通信 | ✅ | |
| **Security Groups** | RDSへのアクセスをCompute IPのみに制限 | ✅ | |
| **IGW** | VPCからインターネットへの出口 | 📝暗黙 | |
| **ルートテーブル** | サブネットごとの経路制御 | 🔧詳細設計 | |
| **Network ACL** | サブネットレベルのファイアウォール | 🔧詳細設計 | |
| **NAT Gateway** | Private SubnetからのOutbound接続 | ✅ | |
| **VPC Peering / PrivateLink** | 異なるVPC間の接続 | 🔧詳細設計 | 必要に応じて |

---

## 2. セキュリティ層

| 要素 | 説明 | ステータス | 備考 |
|------|------|------------|------|
| **IAM Role** | S3アクセス権限（Instance Profile経由） | ✅ | |
| **IAM User** | Access Keyによるアクセス | ⛔移行後不要 | 移行前のみ使用 |
| **Secrets Manager** | DB接続情報の安全な管理 | ✅ | |
| **KMS** | 暗号化キーの管理 | 🔧詳細設計 | |
| **WAF** | Webアプリケーションファイアウォール | ⛔不要 | HTTPアクセスなし |

---

## 3. コンピュート層

| 要素 | 説明 | ステータス | 備考 |
|------|------|------------|------|
| **Databricks Compute** | EC2ベースのSparkクラスタ | ✅ | 同一VPC内 |
| **RDS PostgreSQL** | ソースデータ（Northwind） | ✅ | Private Subnet内 |
| **Lambda** | サーバーレス関数 | ⛔不要 | |
| **ECS / EKS** | コンテナオーケストレーション | ⛔不要 | |

---

## 4. データ層（ストレージ）

| 要素 | 説明 | ステータス | 備考 |
|------|------|------------|------|
| **S3** | データレイク（Delta Lake形式） | ✅ | |
| **Redshift / Athena** | 分析用データウェアハウス | ⛔不要 | Databricks使用 |
| **DynamoDB** | NoSQL | ⛔不要 | |

---

## 5. 監視・運用層

| 要素 | 説明 | ステータス | 備考 |
|------|------|------------|------|
| **CloudWatch** | ログ・メトリクス・アラート | ✅ | |
| **SNS** | 通知（メール/Slack等） | ✅ | |
| **CloudTrail** | API呼び出しの監査ログ | 🔧詳細設計 | |
| **EventBridge** | イベント駆動のトリガー | 🔧詳細設計 | |

---

## 6. 外部連携層

| 要素 | 説明 | ステータス | 備考 |
|------|------|------------|------|
| **Databricks Control Plane** | SaaSの管理コンソール | ✅ | |
| **外部API** | 他システムとの連携 | ⛔不要 | |
| **VPN / Direct Connect** | オンプレミスとの接続 | ⛔不要 | |

---

## 移行後の特徴まとめ

| 特徴 | 内容 |
|------|------|
| **Databricks環境** | AWS上（同一VPC内） |
| **RDSアクセス** | Private Subnet + VPC内通信 |
| **S3認証** | IAM Role（Instance Profile） |
| **セキュリティレベル** | 高（VPC内完結） |

---

## 移行前との差分

| 項目 | 移行前（暫定） | 移行後（最終） |
|------|----------------|----------------|
| Databricks環境 | 外部（Databricks管理） | AWS上（同一VPC） |
| RDSアクセス | パブリックIP + SG制限 | Private Subnet + VPC内通信 |
| S3認証 | IAM User (Access Key) | IAM Role (Instance Profile) |
| セキュリティ | 中（インターネット経由） | 高（VPC内完結） |
| NAT Gateway | 不要 | 必要 |
