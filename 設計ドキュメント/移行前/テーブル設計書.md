# テーブル設計書（Bronze/Silver/Gold）

## 1. Bronze層

### 1.1 概要
- **保存形式**: Delta Lake
- **保存場所**: `abfss://bronze@<storage-account>.dfs.core.windows.net/`
- **更新方式**: Append（日次スナップショット）

### 1.2 テーブル一覧

| テーブル名 | ソース | 説明 |
|-----------|--------|------|
| bronze_customers | RDS.customers | 顧客マスタ（Raw） |
| bronze_orders | RDS.orders | 受注データ（Raw） |
| bronze_order_details | RDS.order_details | 受注明細（Raw） |
| bronze_products | RDS.products | 商品マスタ（Raw） |
| bronze_categories | RDS.categories | カテゴリ（Raw） |
| bronze_suppliers | RDS.suppliers | 仕入先（Raw） |
| bronze_employees | RDS.employees | 従業員（Raw） |
| bronze_shippers | RDS.shippers | 配送業者（Raw） |

### 1.3 追加カラム（メタデータ）

| カラム名 | 型 | 説明 |
|---------|-----|------|
| _load_date | DATE | 取り込み日 |
| _load_timestamp | TIMESTAMP | 取り込み日時 |
| _source_system | STRING | ソースシステム名 |

---

## 2. Silver層

### 2.1 概要
- **保存形式**: Delta Lake
- **保存場所**: `abfss://silver@<storage-account>.dfs.core.windows.net/`
- **更新方式**: Merge/Overwrite

### 2.2 テーブル一覧

| テーブル名 | ソース | 変換内容 |
|-----------|--------|---------|
| silver_customers | bronze_customers | Null処理、型変換 |
| silver_orders | bronze_orders | 日付型変換、Null処理 |
| silver_order_details | bronze_order_details | 金額計算 |
| silver_products | bronze_products | カテゴリ結合 |

### 2.3 クレンジングルール

| ルール | 説明 |
|--------|------|
| Null→デフォルト値 | 数値は0、文字列は空文字 |
| 日付型変換 | VARCHAR→DATE/TIMESTAMP |
| 正規化 | 文字列のトリム、大文字統一 |

---

## 3. Gold層

### 3.1 概要
- **保存形式**: Delta Lake
- **保存場所**: `abfss://gold@<storage-account>.dfs.core.windows.net/`
- **更新方式**: Overwrite

### 3.2 マートテーブル一覧

| テーブル名 | 説明 | 粒度 |
|-----------|------|------|
| gold_sales_by_product | 商品別売上 | 商品×月 |
| gold_sales_by_customer | 顧客別売上 | 顧客×月 |
| gold_sales_by_category | カテゴリ別売上 | カテゴリ×月 |
| gold_order_summary | 受注サマリ | 日次 |

---

## 変更履歴

| 日付 | 変更内容 |
|------|----------|
| 2026-02-09 | 初版作成 |
