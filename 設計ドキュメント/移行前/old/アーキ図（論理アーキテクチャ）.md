# 論理アーキテクチャ図（移行前：外部Databricks接続）

このダイアグラムは「**何をどう処理するか**」を示す論理的な構成図です。
移行前（暫定構成）では、DatabricksがAWS外部にあるため、一部の接続方法が異なります。

```mermaid
flowchart LR
  %% ============================
  %% ノード定義
  %% ============================
  
  subgraph SourceSystem["ソースシステム (AWS)"]
    src[("RDS PostgreSQL<br/>(Northwind)")]
  end

  subgraph ProcessingEngine["処理エンジン (Databricks外部)"]
    dbx["Databricks<br/>Notebooks/Jobs<br/>(ELT処理)"]
    accesskey["Access Key<br/>(IAM Userの認証情報)"]
  end

  subgraph DataLake["データレイク (AWS S3)"]
    b["Bronze<br/>(生データ/スナップショット)"]
    s["Silver<br/>(クレンジング/標準化済)"]
    g["Gold<br/>(集計/マート)"]
    ops[("Ops<br/>(ログ/品質/リネージ)")]
  end

  subgraph Consumers["利用者"]
    analyst["Analyst<br/>(Databricks SQL)"]
  end

  %% ============================
  %% データフロー
  %% ============================
  src -->|"1. JDBC抽出<br/>(インターネット経由)"| dbx
  accesskey -.->|"S3認証"| dbx

  dbx -->|"2. Load"| b
  b -->|"3. Transform"| s
  s -->|"4. Aggregate"| g

  dbx -.->|"ログ/DQ結果"| ops

  g --> analyst
  ops -.-> analyst
```

## 凡例

| 記号 | 意味 |
|------|------|
| `→` (実線) | データの流れ |
| `-.->` (点線) | メタデータ/制御の流れ |
| `[( )]` | データストア (DB/ファイル) |
| `[ ]` | 処理/サービス |

## 移行前の特徴

- **JDBC接続**: インターネット経由でRDSに接続（SSL必須）
- **S3接続**: IAM User の Access Key を使用（Instance Profile は使えない）
- **セキュリティ**: RDSをパブリックに公開する必要があり、IP制限が重要
