# システム構成図の要素一覧（移行前：Azure Databricks + Azure ADLS）

この資料は、**移行前（暫定構成：Azure Databricks + Azure ADLS Gen2）** のシステム構成図に含める要素を網羅的にリストアップしたものです。

## ステータス凡例

| ステータス | 意味 |
|------------|------|
| ✅ 記載済み | 図に明示的に記載 |
| 📝 暗黙 | 図には未記載だが、存在が前提となっている |
| 🔧 詳細設計で追加 | 本番環境向けに詳細設計フェーズで追加すべき |
| ⛔ 今回不要 | 今回のプロジェクトでは使用しない |
| ⛔ 移行前不要 | 移行前の暫定構成では不要（移行後で使用） |

---

## 1. Azure Databricks 層

| 要素 | 説明 | ステータス | 備考 |
|------|------|------------|------|
| **Control Plane** | SaaSの管理コンソール | ✅ | |
| **Compute** | Azure VMベースのSparkクラスタ | ✅ | |
| **Unity Catalog** | メタデータ/リネージ/アクセス制御 | ✅ | |
| **Databricks Secrets** | 認証情報の安全な管理 | ✅ | RDS認証情報を保存 |

---

## 2. Azure Storage 層（データレイク）

| 要素 | 説明 | ステータス | 備考 |
|------|------|------------|------|
| **ADLS Gen2** | データレイク（Delta Lake形式） | ✅ | Hierarchical Namespace有効 |
| **bronze/** | 受領データ（Raw） | ✅ | |
| **silver/** | クレンジング済みデータ | ✅ | |
| **gold/** | 集計・分析用データ | ✅ | |
| **Access Connector** | DatabricksとADLSを接続 | ✅ | |
| **Managed Identity** | ADLSへの認証（パスワードレス） | ✅ | Storage Blob Data Contributor |

---

## 3. AWS ネットワーク層（RDSのみ）

| 要素 | 説明 | ステータス | 備考 |
|------|------|------------|------|
| **VPC** | RDSを配置するネットワーク | ✅ | |
| **Public Subnet** | RDSをパブリックアクセス可能に配置 | ✅ | |
| **Security Group** | Azure DatabricksのIPからのアクセスのみ許可 | ✅ | |
| **IGW** | VPCからインターネットへの出口 | 📝暗黙 | |

---

## 4. AWS セキュリティ層

| 要素 | 説明 | ステータス | 備考 |
|------|------|------------|------|
| **AWS Secrets Manager** | DB接続情報の安全な管理 | ✅ | |
| **IAM User** | S3アクセス用（Access Key） | ⛔不要 | ADLSに変更 |
| **IAM Role** | S3アクセス用 | ⛔不要 | ADLSに変更 |

---

## 5. AWS コンピュート層

| 要素 | 説明 | ステータス | 備考 |
|------|------|------------|------|
| **RDS PostgreSQL** | ソースデータ（Northwind） | ✅ | パブリックアクセス有効 |

---

## 6. AWS ストレージ層（不使用）

| 要素 | 説明 | ステータス | 備考 |
|------|------|------------|------|
| **S3** | データレイク | ⛔不要 | ADLSに変更 |

---

## 移行前の特徴まとめ

| 特徴 | 内容 |
|------|------|
| **Databricks環境** | Azure Databricks（有料版） |
| **Unity Catalog** | ✅ 使用可能 |
| **データレイク** | Azure ADLS Gen2 |
| **ストレージ認証** | Managed Identity（パスワードレス） |
| **RDSアクセス** | パブリックエンドポイント + Security Group制限 |
| **クラウド構成** | Azure (Databricks+ADLS) ↔ AWS (RDSのみ) |
| **セキュリティレベル** | 中（RDSへのアクセスのみインターネット経由） |

## 変更履歴

| 日付 | 変更内容 |
|------|----------|
| 2024-02-08 | データレイクをAWS S3からAzure ADLS Gen2に変更 |
