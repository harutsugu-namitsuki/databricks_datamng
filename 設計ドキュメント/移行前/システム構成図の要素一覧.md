# システム構成図の要素一覧（移行前：Azure Databricks → AWS）

この資料は、**移行前（暫定構成：Azure Databricks → AWS クロスクラウド）** のシステム構成図に含めるべき要素を網羅的にリストアップしたものです。

## ステータス凡例

| ステータス | 意味 |
|------------|------|
| ✅ 記載済み | 図に明示的に記載 |
| 📝 暗黙 | 図には未記載だが、存在が前提となっている |
| 🔧 詳細設計で追加 | 本番環境向けに詳細設計フェーズで追加すべき |
| ⛔ 今回不要 | 今回のプロジェクトでは使用しない |
| ⛔ 移行前不要 | 移行前の暫定構成では不要（移行後で使用） |

---

## 1. Azure Databricks 層

| 要素 | 説明 | ステータス | 備考 |
|------|------|------------|------|
| **Control Plane** | SaaSの管理コンソール | ✅ | |
| **Compute** | Azure VMベースのSparkクラスタ | ✅ | |
| **Unity Catalog** | メタデータ/リネージ/アクセス制御 | ✅ | |
| **Databricks Secrets** | 認証情報の安全な管理 | ✅ | AWS認証情報を保存 |

---

## 2. AWS ネットワーク層

| 要素 | 説明 | ステータス | 備考 |
|------|------|------------|------|
| **VPC** | RDSを配置するネットワーク | ✅ | |
| **Public Subnet** | RDSをパブリックアクセス可能に配置 | ✅ | 移行前はPublic Subnetのみ |
| **Private Subnet** | インターネット非公開のサブネット | ⛔移行前不要 | 移行後で使用 |
| **Security Group** | Azure DatabricksのIPからのアクセスのみ許可 | ✅ | |
| **IGW** | VPCからインターネットへの出口 | 📝暗黙 | |
| **ルートテーブル** | サブネットの経路制御 | 🔧詳細設計 | |
| **Network ACL** | サブネットレベルのファイアウォール | 🔧詳細設計 | |
| **NAT Gateway** | Private Subnetからの外部通信 | ⛔移行前不要 | 移行後で使用 |
| **PrivateLink** | VPC間のプライベート接続 | ⛔移行前不要 | 移行後で検討 |

---

## 3. AWS セキュリティ層

| 要素 | 説明 | ステータス | 備考 |
|------|------|------------|------|
| **IAM User** | Azure DatabricksからのS3アクセス用（Access Key） | ✅ | 移行前のみ使用 |
| **IAM Role** | Instance Profile経由のS3アクセス | ⛔移行前不要 | 移行後で使用 |
| **AWS Secrets Manager** | DB接続情報の安全な管理 | ✅ | |
| **KMS** | 暗号化キーの管理 | 🔧詳細設計 | |
| **WAF** | Webアプリケーションファイアウォール | ⛔不要 | HTTPアクセスなし |

---

## 4. AWS コンピュート層

| 要素 | 説明 | ステータス | 備考 |
|------|------|------------|------|
| **RDS PostgreSQL** | ソースデータ（Northwind） | ✅ | パブリックアクセス有効 |
| **Lambda** | サーバーレス関数 | ⛔不要 | |
| **ECS / EKS** | コンテナオーケストレーション | ⛔不要 | |

---

## 5. AWS データ層（ストレージ）

| 要素 | 説明 | ステータス | 備考 |
|------|------|------------|------|
| **S3** | データレイク（Delta Lake形式） | ✅ | |
| **Redshift / Athena** | 分析用データウェアハウス | ⛔不要 | Databricks使用 |
| **DynamoDB** | NoSQL | ⛔不要 | |

---

## 6. 監視・運用層

| 要素 | 説明 | ステータス | 備考 |
|------|------|------------|------|
| **CloudWatch** | ログ・メトリクス・アラート | 🔧詳細設計 | 移行前は簡易運用 |
| **CloudTrail** | API呼び出しの監査ログ | 🔧詳細設計 | |
| **SNS** | 通知（メール/Slack等） | 🔧詳細設計 | 移行前は簡易運用 |
| **EventBridge** | イベント駆動のトリガー | 🔧詳細設計 | |

---

## 7. 外部連携層

| 要素 | 説明 | ステータス | 備考 |
|------|------|------------|------|
| **Azure ↔ AWS** | クロスクラウド接続（インターネット経由） | ✅ | |
| **外部API** | 他システムとの連携 | ⛔不要 | |
| **VPN / Direct Connect** | オンプレミスとの接続 | ⛔不要 | |

---

## 移行前の特徴まとめ

| 特徴 | 内容 |
|------|------|
| **Databricks環境** | Azure Databricks（有料版） |
| **Unity Catalog** | ✅ 使用可能 |
| **RDSアクセス** | パブリックエンドポイント + Security Group制限 |
| **S3認証** | IAM User（Access Key） |
| **クラウド構成** | Azure ↔ AWS クロスクラウド |
| **セキュリティレベル** | 中（インターネット経由） |
