# トラブルシューティングガイド

## 1. 接続エラー

### 1.1 RDS接続エラー

**症状**: `Connection refused` または `timeout`

**原因と対策**:

| 原因 | 対策 |
|------|------|
| Security Groupの設定不備 | RDSのSGでDatabricks IPを許可 |
| RDSが停止中 | AWSコンソールでRDS起動 |
| エンドポイント誤り | 接続文字列を確認 |
| SSL設定不備 | `sslmode=require` を追加 |

---

### 1.2 ADLS接続エラー

**症状**: `403 Forbidden` または `AuthorizationFailure`

**原因と対策**:

| 原因 | 対策 |
|------|------|
| ロール未割当 | Storage Blob Data Contributor を確認 |
| Access Connector未設定 | Storage Credentialを再作成 |
| パス誤り | `abfss://container@account.dfs.core.windows.net/` 形式確認 |

---

## 2. ETLエラー

### 2.1 Bronze Ingestエラー

**症状**: `Table not found` または `Column not found`

**対策**:
1. RDSにテーブルが存在するか確認
2. `01_load_northwind_to_rds.py` を再実行

---

### 2.2 Silver Transformエラー

**症状**: `AnalysisException` または型変換エラー

**対策**:
1. Bronzeテーブルのスキーマ確認
2. Null値の処理を確認
3. 変換ロジックを見直し

---

## 3. Unity Catalogエラー

### 3.1 権限エラー

**症状**: `User does not have permission`

**対策**:
1. カタログ/スキーマへの権限確認
2. Storage Credentialの権限確認
3. External Locationの権限確認

---

### 3.2 Storage Credentialエラー

**症状**: `storage credential ... does not exist`

**対策**:
1. `00_setup_unity_catalog.py` を再実行
2. Access Connector リソースIDを確認

---

## 4. よくある質問 (FAQ)

| 質問 | 回答 |
|------|------|
| クラスタが起動しない | クォータ上限を確認、別リージョンを試す |
| ジョブが途中で止まる | タイムアウト設定を延長 |
| データが重複する | Appendではなく Merge を使用 |

---

## 変更履歴

| 日付 | 変更内容 |
|------|----------|
| 2026-02-09 | 初版作成 |
